#include <stdio.h>
#include "color_test.c"
#include <stdlib.h>
#include <time.h>
#include <unistd.h>
#include <termios.h>
#include <fcntl.h>

#define LINHAS 10
#define COLUNAS 135

int jogo = 1;

void movertiro(char map[LINHAS][COLUNAS]){
    
}

void moverfuel(char map[LINHAS][COLUNAS]){
    int i, j=134,random, randomspawn;
    int x,y;

    random = rand() % 8 + 1;
    randomspawn = rand()%100 + 1;

    if(map[random][134] == '.' && randomspawn >= 70 && randomspawn < 100){
       map[random][134] = 'F'; 
    }
    for(i=1;i<LINHAS;i++){
        for(j=1;j<COLUNAS;j++){
            if(map[i][j] == 'F'){
                x = j;
                y = i;
               map[y][x] = '.';
               map[y][x-1] = 'F';
               
               if(x < 0 || x > COLUNAS){
                   map[y][x-1] = map[y][x];
                } 
            }
        }
    } 
}

void moverinimigo(char map[LINHAS][COLUNAS]){
    int i, j=134,random, randomspawn;
    int x,y;

    random = rand() % 8 + 1;
    randomspawn = rand()%100 + 1;

    if(map[random][134] == '.' && randomspawn >= 70 && randomspawn < 100){
       map[random][134] = 'X'; 
    }
    for(i=1;i<LINHAS;i++){
        for(j=1;j<COLUNAS;j++){
            if(map[i][j] == 'X'){
                x = j;
                y = i;
                if(map[y][x-1] == '.'){
                    map[y][x] = '.';
                    map[y][x-1] = 'X';
               }
               if(map[y][x-1] == 'C'){
                    map[y][x] = '.';
                    map[y][x-1] = 'X';
                   jogo = 0;
               }
               if(x < 0 || x > COLUNAS){
                   map[y][x-1] = map[y][x];
                } 
            }
        }
    } 
}

void mover(char map[LINHAS][COLUNAS]){
    char move;
    int i, j;
    int x, y;
    if(kbhit() == 1){
        move = getch();

        /*mover para cima*/
        if (move == 'w'){
            for(i=0;i<LINHAS;i++){
                for(j=0;j<COLUNAS;j++){
                    if(map[i][j] == 'C'){
                        x = j;
                        y = i;
                    }
                
                }
            }
            if((y-1)<1){
                map[y][x] = 'C';
            }
            else{
                map[y][x] = '.';
                map[y-1][x] = 'C';
            }
        }   
        /*mover para baixo*/
        if (move == 's'){
            for(i=0;i<LINHAS;i++){
                for(j=0;j<COLUNAS;j++){
                    if(map[i][j] == 'C'){
                        x = j;
                        y = i;
                    }
                
                }
            }
            /*delimitar tamanho de novo dps*/
            if((y+1)>8){
                map[y][x] = 'C';
            }
            else{
                map[y][x] = '.';
                map[y+1][x] = 'C';
            }
        }

        /*mover para direita*/
        if (move == 'd'){
            for(i=0;i<LINHAS;i++){
                for(j=0;j<COLUNAS;j++){
                    if(map[i][j] == 'C'){
                        x = j;
                        y = i;
                    }
                
                }
            }
            if((x+1)> 134){
                map[y][x] = 'C';
            }
            else{
                map[y][x] = '.';
                map[y][x+1] = 'C';
            }
        }
        /*mover para esquerda*/
        if (move == 'a'){
            for(i=0;i<LINHAS;i++){
                for(j=0;j<COLUNAS;j++){
                    if(map[i][j] == 'C'){
                        x = j;
                        y = i;
                    }
                
                }
            }
            if((x-1)<0){
                map[y][x] = 'C';
            }
            else{
                map[y][x] = '.';
                map[y][x-1] = 'C';
            }
        }
    }
    /* system ("/bin/stty cooked"); */
}

void printar(char map[LINHAS][COLUNAS]){
    int i,j;
    int x,y;
    
    for(i=0;i<LINHAS;i++){
        for(j=0;j<COLUNAS;j++){
            if(map[i][j] == 'C'){
                printf(/*ANSI_COLOR_RED ANSI_COLOR_BK_RED*/ "%c" ANSI_COLOR_RESET, map[i][j]);
            }
            if(map[i][j] == '='){
                printf(/*ANSI_COLOR_GREEN ANSI_COLOR_BK_GREEN*/ "%c" ANSI_COLOR_RESET, map[i][j]);
            }
            if(map[i][j] == '.'){
                if(j == 134){
                    printf(/* ANSI_COLOR_RED ANSI_COLOR_BK_RED */ "%c" ANSI_COLOR_RESET, map[i][j]);
                }else{
                    printf(/*ANSI_COLOR_BLUE ANSI_COLOR_BK_BLUE*/ "%c" ANSI_COLOR_RESET, map[i][j]);
                }
            }
            if(map[i][j] == 'X' && j != 0){
                printf("%c", map[i][j]);
            }
            if(map[i][j] == 'F' && j != 0){
                printf("%c", map[i][j]);
            }
        }
        printf("\n");
    }
}


int main(){
    int i=0, j=0;
    int cont = 0;

    srand(time(NULL));

    char map[LINHAS][COLUNAS] = {
       
        {'=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '='},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'C', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'},
        {'=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '=', '='},
        
    };
    
    while(jogo == 1){
        system(CLEAR);
        moverinimigo(map);
        moverfuel(map);
        movertiro(map);
        printar(map);
        mover(map);
        usleep(50000);
    }
    return 0;
}